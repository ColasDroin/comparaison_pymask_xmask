mylhcbeam = 1;

      ! Get the toolkit
      call,file=
        "acc-models-lhc/toolkit/macro.madx";
      
      ! Build sequence
      option, -echo,-warn,-info;
      if (mylhcbeam==4){
        call,file="acc-models-lhc/lhc/lhcb4.seq";
      } else {
        call,file="acc-models-lhc/lhc/lhc.seq";
      };
      option, -echo, warn,-info;
      
      !Install HL-LHC
      call, file=
        "acc-models-lhc/hllhc_sequence.madx";
      
      ! Slice nominal sequence
      exec, myslice;
      ;

      ! Install placeholder elements for errors (set to zero)
      call, file="errors/HL-LHC/install_MQXF_fringenl.madx";  ! adding fringe place holder
      call, file="errors/HL-LHC/install_MCBXFAB_errors.madx"; !adding D1 corrector placeholders in IR1/5 (for errors)
      call, file="errors/HL-LHC/install_MCBRD_errors.madx";   ! adding D2 corrector placeholders in IR1/5 (for errors)
      call, file="errors/HL-LHC/install_NLC_errors.madx";     !adding non-linear corrector placeholders in IR1/5 (for errors)
    ;

      !Cycling w.r.t. to IP3 (mandatory to find closed orbit in collision in the presence of errors)
      if (mylhcbeam<3){
        seqedit, sequence=lhcb1; flatten; cycle, start=IP3; flatten; endedit;
      };
      seqedit, sequence=lhcb2; flatten; cycle, start=IP3; flatten; endedit;

      ! Install crab cavities (they are off)
      call, file='acc-models-lhc/toolkit/enable_crabcavities.madx';
      on_crab1 = 0;
      on_crab5 = 0;

      ! Set twiss formats for MAD-X parts (macro from opt. toolkit)
      exec, twiss_opt;


      ;
call, file="acc-models-lhc/flatcc/opt_flathv_75_180_1500_thin.madx";
on_alice := on_alice_normalized * 7000./nrj;
on_lhcb := on_lhcb_normalized * 7000./nrj;
nrj = 7000;

    beam, particle=proton,sequence=lhcb1,
        energy=7000,
        sigt=0.0001,
        bv=1,
        npart=1,
        sige=1e-06,
        ex=1.3403886973714285e-10,
        ey=1.3403886973714285e-10,
        mass=0.93827208816,
        charge=1.0;
    ;
use, sequence=lhcb1;
use, sequence=lhcb1;
twiss;

    beam, particle=proton,sequence=lhcb2,
        energy=7000,
        sigt=0.0001,
        bv=-1,
        npart=1,
        sige=1e-06,
        ex=1.3403886973714285e-10,
        ey=1.3403886973714285e-10,
        mass=0.93827208816,
        charge=1.0;
    ;
use, sequence=lhcb2;
use, sequence=lhcb2;
twiss;
use, sequence=lhcb1;
exec, crossing_disable;
exec, crossing_save;
ver_hllhc_optics = 1.5;
par_verbose = 1;
call, file="/home/cdroin/comparison_pymask_xmask/toolkit/xmask/xmask/lhc/madx_scripts/submodule_04a_s1_prepare_nom_twiss_table.madx";
call, file="/home/cdroin/comparison_pymask_xmask/toolkit/xmask/xmask/lhc/madx_scripts/submodule_04e_s1_synthesize_knobs.madx";
